SQL基本语法
```
1、常用函数
    ifnull,isnull

root@192.168.0.254 3307 [employees]>select isnull(null),isnull(0),isnull(1/0);
+--------------+-----------+-------------+
| isnull(null) | isnull(0) | isnull(1/0) |
+--------------+-----------+-------------+
|            1 |         0 |           1 |
+--------------+-----------+-------------+
1 row in set, 1 warning (0.01 sec)

root@192.168.0.254 3307 [employees]>select 1=1,null=null,1=null,1<>null,null is null;
+-----+-----------+--------+---------+--------------+
| 1=1 | null=null | 1=null | 1<>null | null is null |
+-----+-----------+--------+---------+--------------+
|   1 |      NULL |   NULL |    NULL |            1 |
+-----+-----------+--------+---------+--------------+

root@192.168.0.254 3307 [employees]>select 1<=>1,null<=>null,1<=>null,1 is not null,null is not null;
+-------+-------------+----------+---------------+------------------+
| 1<=>1 | null<=>null | 1<=>null | 1 is not null | null is not null |
+-------+-------------+----------+---------------+------------------+
|     1 |           1 |        0 |             1 |                0 |
+-------+-------------+----------+---------------+------------------+

root@192.168.0.254 3308 [employees]>select * from t_order t join (select null b ) c on emp_no<=>b;   //查找出t_order表中emp_no为null的行
+--------+---------+------------+------------+------+
| emp_no | dept_no | from_date  | to_date    | b    |
+--------+---------+------------+------------+------+
|   NULL | d008    | 1986-12-01 | 1992-05-27 | NULL |
+--------+---------+------------+------------+------+

root@192.168.0.254 3308 [employees]>select hex('a');
+----------+
| hex('a') |
+----------+
| 61       |
+----------+
1 row in set (0.00 sec)

root@192.168.0.254 3308 [employees]>select hex(null);
+-----------+
| hex(null) |
+-----------+
| NULL      |
+-----------+
1 row in set (0.01 sec)

root@192.168.0.254 3307 [employees]>select t.* from t_order t;
+--------+---------+------------+------------+
| emp_no | dept_no | from_date  | to_date    |
+--------+---------+------------+------------+
|  22744 | d006    | 1986-12-01 | 9999-01-01 |
|  24007 | d005    | 1986-12-01 | 9999-01-01 |
|  30970 | d005    | 1986-12-01 | 2017-03-29 |
|  31112 | d002    | 1986-12-01 | 1993-12-10 |
|  40983 | d005    | 1986-12-01 | 9999-01-01 |
|   NULL | d008    | 1986-12-01 | 1992-05-27 |
|  48317 | d008    | 1986-12-01 | 1989-01-11 |
|  49667 | d007    | 1986-12-01 | 9999-01-01 |
|  50449 | d005    | 1986-12-01 | 9999-01-01 |
|  10004 | d004    | 1986-12-01 | 9999-01-01 |
+--------+---------+------------+------------+

root@192.168.0.254 3307 [employees]>select count(emp_no) from t_order;
+---------------+
| count(emp_no) |
+---------------+
|             9 |
+---------------+
1 row in set (0.00 sec)

root@192.168.0.254 3307 [employees]>select count(concat(ifnull(emp_no,''),dept_no)) from t_order t;
+------------------------------------------+
| count(concat(ifnull(emp_no,''),dept_no)) |
+------------------------------------------+
|                                       10 |
+------------------------------------------+



2、日期类型 ,now,sysdate

root@192.168.0.254 3308 [employees]>select now(),sleep(2),now();
+---------------------+----------+---------------------+
| now()               | sleep(2) | now()               |
+---------------------+----------+---------------------+
| 2020-03-13 23:12:25 |        0 | 2020-03-13 23:12:25 |
+---------------------+----------+---------------------+
1 row in set (2.00 sec)

root@192.168.0.254 3308 [employees]>select sysdate(),sleep(2),sysdate();   //建议不要用sysdate函数
+---------------------+----------+---------------------+
| sysdate()           | sleep(2) | sysdate()           |
+---------------------+----------+---------------------+
| 2020-03-13 23:12:42 |        0 | 2020-03-13 23:12:44 |
+---------------------+----------+---------------------+
1 row in set (2.00 sec)

root@192.168.0.254 3308 [employees]>desc select * from salaries where emp_no=10001 and from_date>now();    //now能用索引
+----+-------------+----------+------------+-------+----------------+---------+---------+------+------+----------+-------------+
| id | select_type | table    | partitions | type  | possible_keys  | key     | key_len | ref  | rows | filtered | Extra       |
+----+-------------+----------+------------+-------+----------------+---------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | salaries | NULL       | range | PRIMARY,emp_no | PRIMARY | 7       | NULL |    1 |   100.00 | Using where |
+----+-------------+----------+------------+-------+----------------+---------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.03 sec)

root@192.168.0.254 3308 [employees]>desc select * from salaries where emp_no=10001 and from_date>sysdate();      //sysdate不能用索引,因为sysdate是动态 的
+----+-------------+----------+------------+------+----------------+---------+---------+-------+------+----------+-------------+
| id | select_type | table    | partitions | type | possible_keys  | key     | key_len | ref   | rows | filtered | Extra       |
+----+-------------+----------+------------+------+----------------+---------+---------+-------+------+----------+-------------+
|  1 | SIMPLE      | salaries | NULL       | ref  | PRIMARY,emp_no | PRIMARY | 4       | const |   17 |    33.33 | Using where |
+----+-------------+----------+------------+------+----------------+---------+---------+-------+------+----------+-------------+
1 row in set, 1 warning (0.04 sec)

sysdate函数SQL改写
root@192.168.0.254 3308 [employees]>desc select * from salaries,(select sysdate() d) d where emp_no=10001 and from_date>d.d;   //将sysdate动态 变静态 
+----+-------------+------------+------------+--------+----------------+---------+---------+------+------+----------+----------------+
| id | select_type | table      | partitions | type   | possible_keys  | key     | key_len | ref  | rows | filtered | Extra          |
+----+-------------+------------+------------+--------+----------------+---------+---------+------+------+----------+----------------+
|  1 | PRIMARY     | <derived2> | NULL       | system | NULL           | NULL    | NULL    | NULL |    1 |   100.00 | NULL           |
|  1 | PRIMARY     | salaries   | NULL       | range  | PRIMARY,emp_no | PRIMARY | 7       | NULL |    1 |   100.00 | Using where    |
|  2 | DERIVED     | NULL       | NULL       | NULL   | NULL           | NULL    | NULL    | NULL | NULL |     NULL | No tables used |
+----+-------------+------------+------------+--------+----------------+---------+---------+------+------+----------+----------------+
3 rows in set, 1 warning (0.01 sec)**

3、常用字符串函数 RPAD,LPAD,RTRIM,LTRIM,TRIM,用于ETL比较多
root@192.168.0.254 3307 [employees]>SELECT RPAD ('A',10,'0');
+-------------------+
| RPAD ('A',10,'0') |
+-------------------+
| A000000000        |
+-------------------+
1 row in set (0.10 sec)

root@192.168.0.254 3307 [employees]>SELECT LPAD ('A',10,'0');
+-------------------+
| LPAD ('A',10,'0') |
+-------------------+
| 000000000A        |
+-------------------+
1 row in set (0.00 sec)

root@192.168.0.254 3307 [employees]>SELECT RTRIM('A    '),LENGTH(RTRIM('A    '));     //也是ETL比较多
+----------------+------------------------+
| RTRIM('A    ') | LENGTH(RTRIM('A    ')) |
+----------------+------------------------+
| A              |                      1 |
+----------------+------------------------+
1 row in set (0.00 sec)

root@192.168.0.254 3307 [employees]>SELECT LTRIM('    A'),LENGTH(LTRIM('    A'));
+----------------+------------------------+
| LTRIM('    A') | LENGTH(LTRIM('    A')) |
+----------------+------------------------+
| A              |                      1 |
+----------------+------------------------+

root@192.168.0.254 3307 [employees]>SELECT TRIM('  A  '),LENGTH(TRIM('  A  '));
+---------------+-----------------------+
| TRIM('  A  ') | LENGTH(TRIM('  A  ')) |
+---------------+-----------------------+
| A             |                     1 |
+---------------+-----------------------+

字符合并的方法
root@192.168.0.254 3307 [employees]>select concat('a','bc');
+------------------+
| concat('a','bc') |
+------------------+
| abc              |
+------------------+
1 row in set (0.01 sec)

root@192.168.0.254 3307 [employees]>set sql_mode='PIPES_AS_CONCAT';   //不建议使用
Query OK, 0 rows affected (0.00 sec)

root@192.168.0.254 3307 [employees]>select 'a'||'bc';
+-----------+
| 'a'||'bc' |
+-----------+
| abc       |
+-----------+
1 row in set (0.00 sec)

改变数据类型
root@192.168.0.254 3307 [employees]>SELECT HEX(1);
+--------+
| HEX(1) |
+--------+
| 1      |
+--------+
1 row in set (0.00 sec)

root@192.168.0.254 3307 [employees]>SELECT HEX(CONCAT(1,''));   //数据类型转换为字符串类型
+-------------------+
| HEX(CONCAT(1,'')) |
+-------------------+
| 31                |
+-------------------+


数字类型的特殊性
root@192.168.0.254 3307 [employees]>select 1 + '1';
+---------+
| 1 + '1' |
+---------+
|       2 |
+---------+
1 row in set (0.00 sec)

root@192.168.0.254 3307 [employees]>select 1 + '1a';
+----------+
| 1 + '1a' |
+----------+
|        2 |
+----------+
1 row in set, 1 warning (0.00 sec)

root@192.168.0.254 3307 [employees]>select 'a' + 'b' + 1 + 2;
+-------------------+
| 'a' + 'b' + 1 + 2 |
+-------------------+
|                 3 |
+-------------------+
1 row in set, 2 warnings (0.00 sec)
案例:
root@192.168.0.254 3307 [employees]>select * from test1;
+------+------+
| id   | n    |
+------+------+
| 1000 | NULL |
| NULL | NULL |
| 1b   | NULL |
+------+------+
3 rows in set (0.00 sec)

root@192.168.0.254 3307 [employees]>select * from test1 where id=1;;
+------+------+
| id   | n    |
+------+------+
| 1b   | NULL |
+------+------+
1 row in set, 1 warning (0.00 sec)

ERROR: 
No query specified

root@192.168.0.254 3307 [employees]>select * from test1 where id='1';
Empty set (0.00 sec)

数字类型的特殊性，类似这样的问题，需要类型转换，数字类型比字符类型优先，所以把数字类型制转换成字符类型
例：
root@192.168.0.254 3307 [employees]>select * from t_order;
+--------+---------+------------+------------+
| emp_no | dept_no | from_date  | to_date    |
+--------+---------+------------+------------+
|  22744 | d006    | 1986-12-01 | 9999-01-01 |
|  24007 | d005    | 1986-12-01 | 9999-01-01 |
|  30970 | d005    | 1986-12-01 | 2017-03-29 |
|  31112 | d002    | 1986-12-01 | 1993-12-10 |
|  40983 | d005    | 1986-12-01 | 9999-01-01 |
|   NULL | d008    | 1986-12-01 | 1992-05-27 |
|  48317 | d008    | 1986-12-01 | 1989-01-11 |
|  49667 | d007    | 1986-12-01 | 9999-01-01 |
|  50449 | d005    | 1986-12-01 | 9999-01-01 |
|  10004 | d004    | 1986-12-01 | 9999-01-01 |
+--------+---------+------------+------------+
root@192.168.0.254 3307 [employees]>select * from test1;
+------------+------+
| id         | n    |
+------------+------+
| 1000       | NULL |
| NULL       | NULL |
| 1b         | NULL |
| 22744aaabb | NULL |
+------------+------+
4 rows in set (0.00 sec)

root@192.168.0.254 3307 [employees]>select t1.*,t2.* from test1 t1 join t_order t2 on t1.id=t2.emp_no;   //结果不正确
+------------+------+--------+---------+------------+------------+
| id         | n    | emp_no | dept_no | from_date  | to_date    |
+------------+------+--------+---------+------------+------------+
| 22744aaabb | NULL |  22744 | d006    | 1986-12-01 | 9999-01-01 |
+------------+------+--------+---------+------------+------------+
1 row in set, 1 warning (0.01 sec)

root@192.168.0.254 3307 [employees]>select t1.*,t2.* from test1 t1 join t_order t2 on t1.id=concat(t2.emp_no,'');
Empty set (0.00 sec)

root@192.168.0.254 3307 [employees]>desc select t1.*,t2.* from test1 t1 join t_order t2 on t1.id=concat(t2.emp_no,'');
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                                              |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+
|  1 | SIMPLE      | t1    | NULL       | ALL  | ix_id         | NULL | NULL    | NULL |    4 |   100.00 | NULL                                               |
|  1 | SIMPLE      | t2    | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   10 |   100.00 | Using where; Using join buffer (Block Nested Loop) |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+
2 rows in set, 1 warning (0.01 sec)

root@192.168.0.254 3307 [employees]>desc select  t1.*,t2.* from t_order t1 force index(ix_t1) join test1 t2 on t2.id=t1.emp_no;
+----+-------------+-------+------------+------+---------------+-------+---------+-----------------+------+----------+-----------------------+
| id | select_type | table | partitions | type | possible_keys | key   | key_len | ref             | rows | filtered | Extra                 |
+----+-------------+-------+------------+------+---------------+-------+---------+-----------------+------+----------+-----------------------+
|  1 | SIMPLE      | t2    | NULL       | ALL  | ix_id         | NULL  | NULL    | NULL            |    4 |   100.00 | Using where           |
|  1 | SIMPLE      | t1    | NULL       | ref  | ix_t1         | ix_t1 | 5       | employees.t2.id |    1 |   100.00 | Using index condition |
+----+-------------+-------+------------+------+---------------+-------+---------+-----------------+------+----------+-----------------------+

root@192.168.0.254 3307 [employees]>desc select * from test1 where id=10;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | test1 | NULL       | ALL  | ix_id         | NULL | NULL    | NULL |    4 |    25.00 | Using where |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 3 warnings (0.00 sec)

root@192.168.0.254 3307 [employees]>show warnings;
+---------+------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level   | Code | Message                                                                                                                                              |
+---------+------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| Warning | 1739 | Cannot use ref access on index 'ix_id' due to type or collation conversion on field 'id'                                                             |
| Warning | 1739 | Cannot use range access on index 'ix_id' due to type or collation conversion on field 'id'                                                           |
| Note    | 1003 | /* select#1 */ select `employees`.`test1`.`id` AS `id`,`employees`.`test1`.`n` AS `n` from `employees`.`test1` where (`employees`.`test1`.`id` = 10) |
+---------+------+------------------------------------------------------------------------------------------------------------------------------------------------------+
3 rows in set (0.00 sec)


日期类型 的特殊性
别的数据库，日期类型必须得转换，mysql则不需要，他会自动转换，只需要书写格式是按照日期类型之所以的，，不用日期函数转换
root@192.168.0.254 3308 [employees]>desc select emp_no from salaries where emp_no=10001 and  from_date='1994-06-24' ;    //一般正常情况
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+
| id | select_type | table    | partitions | type  | possible_keys  | key     | key_len | ref         | rows | filtered | Extra       |
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+
|  1 | SIMPLE      | salaries | NULL       | const | PRIMARY,emp_no | PRIMARY | 7       | const,const |    1 |   100.00 | Using index |
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+

root@192.168.0.254 3308 [employees]>desc select emp_no from salaries where emp_no=10001 and  from_date=str_to_date('1994-06-24','%Y-%m-%d') ;    //使用了str_to_date函数,也能使用索引
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+
| id | select_type | table    | partitions | type  | possible_keys  | key     | key_len | ref         | rows | filtered | Extra       |
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+
|  1 | SIMPLE      | salaries | NULL       | const | PRIMARY,emp_no | PRIMARY | 7       | const,const |    1 |   100.00 | Using index |
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+

root@192.168.0.254 3308 [employees]>desc select emp_no from salaries where emp_no=10001 and  from_date='19940624' ;                      //能使用索引，但不建议使用
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+
| id | select_type | table    | partitions | type  | possible_keys  | key     | key_len | ref         | rows | filtered | Extra       |
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+
|  1 | SIMPLE      | salaries | NULL       | const | PRIMARY,emp_no | PRIMARY | 7       | const,const |    1 |   100.00 | Using index |
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)

root@192.168.0.254 3308 [employees]>desc select emp_no from salaries where emp_no=10001 and  from_date=19940624 ;                //能使用索引，但不建议使用
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+
| id | select_type | table    | partitions | type  | possible_keys  | key     | key_len | ref         | rows | filtered | Extra       |
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+
|  1 | SIMPLE      | salaries | NULL       | const | PRIMARY,emp_no | PRIMARY | 7       | const,const |    1 |   100.00 | Using index |
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------------+

3、between 和  in 的相同和区别
字符类型，不能使用between ，性能较差
root@192.168.0.254 3308 [employees]>desc select * from dept_emp2 force index(ix_dept_emp) where dept_no between 'd002' and 'd004' and emp_no=10015;
+----+-------------+-----------+------------+-------+---------------+-------------+---------+------+-------+----------+-----------------------+
| id | select_type | table     | partitions | type  | possible_keys | key         | key_len | ref  | rows  | filtered | Extra                 |
+----+-------------+-----------+------------+-------+---------------+-------------+---------+------+-------+----------+-----------------------+
|  1 | SIMPLE      | dept_emp2 | NULL       | range | ix_dept_emp   | ix_dept_emp | 16      | NULL | 60846 |    10.00 | Using index condition |
+----+-------------+-----------+------------+-------+---------------+-------------+---------+------+-------+----------+-----------------------+
1 row in set, 1 warning (0.09 sec)

把between改成in性能较好，看filtered
root@192.168.0.254 3308 [employees]>desc select * from dept_emp2 force index(ix_dept_emp) where dept_no in  ('d002''d004') and emp_no=10015;
+----+-------------+-----------+------------+------+---------------+-------------+---------+-------------+------+----------+-----------------------+
| id | select_type | table     | partitions | type | possible_keys | key         | key_len | ref         | rows | filtered | Extra                 |
+----+-------------+-----------+------------+------+---------------+-------------+---------+-------------+------+----------+-----------------------+
|  1 | SIMPLE      | dept_emp2 | NULL       | ref  | ix_dept_emp   | ix_dept_emp | 16      | const,const |    1 |   100.00 | Using index condition |
+----+-------------+-----------+------------+------+---------------+-------------+---------+-------------+------+----------+-----------------------+
1 row in set, 1 warning (0.00 sec)

也可以使用union all 改写如下：
root@192.168.0.254 3308 [employees]>desc select * from dept_emp2 force index(ix_dept_emp) where dept_no='d002' and emp_no=10015
    -> union all 
    -> select * from dept_emp2 force index(ix_dept_emp) where dept_no='d003' and emp_no=10015
    -> union all 
    -> select * from dept_emp2 force index(ix_dept_emp) where dept_no='d004' and emp_no=10015;
+----+-------------+-----------+------------+------+---------------+-------------+---------+-------------+------+----------+-------+
| id | select_type | table     | partitions | type | possible_keys | key         | key_len | ref         | rows | filtered | Extra |
+----+-------------+-----------+------------+------+---------------+-------------+---------+-------------+------+----------+-------+
|  1 | PRIMARY     | dept_emp2 | NULL       | ref  | ix_dept_emp   | ix_dept_emp | 16      | const,const |    1 |   100.00 | NULL  |
|  2 | UNION       | dept_emp2 | NULL       | ref  | ix_dept_emp   | ix_dept_emp | 16      | const,const |    1 |   100.00 | NULL  |
|  3 | UNION       | dept_emp2 | NULL       | ref  | ix_dept_emp   | ix_dept_emp | 16      | const,const |    1 |   100.00 | NULL  |
+----+-------------+-----------+------------+------+---------------+-------------+---------+-------------+------+----------+-------+
3 rows in set, 1 warning (0.04 sec)


索引如下，下面情况between要比in效果好，原因是primary索引条件好，即过滤条件emp_no在索引最左边的原则
root@192.168.0.254 3308 [employees]>show index from dept_emp;
+----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| Table    | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |
+----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| dept_emp |          0 | PRIMARY  |            1 | emp_no      | A         |      299819 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| dept_emp |          0 | PRIMARY  |            2 | dept_no     | A         |      331143 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| dept_emp |          1 | emp_no   |            1 | emp_no      | A         |      300623 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| dept_emp |          1 | dept_no  |            1 | dept_no     | A         |           8 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
+----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
4 rows in set (0.09 sec)


root@192.168.0.254 3308 [employees]>desc select * from dept_emp where dept_no in ('d003','d004','d005') and emp_no=10005;
+----+-------------+----------+------------+-------+------------------------+---------+---------+------+------+----------+-------------+
| id | select_type | table    | partitions | type  | possible_keys          | key     | key_len | ref  | rows | filtered | Extra       |
+----+-------------+----------+------------+-------+------------------------+---------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | dept_emp | NULL       | range | PRIMARY,emp_no,dept_no | PRIMARY | 16      | NULL |    3 |   100.00 | Using where |
+----+-------------+----------+------------+-------+------------------------+---------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.04 sec)

root@192.168.0.254 3308 [employees]>desc select * from dept_emp where dept_no between 'd003' and 'd005' and emp_no=10005;
+----+-------------+----------+------------+-------+------------------------+---------+---------+------+------+----------+-------------+
| id | select_type | table    | partitions | type  | possible_keys          | key     | key_len | ref  | rows | filtered | Extra       |
+----+-------------+----------+------------+-------+------------------------+---------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | dept_emp | NULL       | range | PRIMARY,emp_no,dept_no | PRIMARY | 16      | NULL |    1 |   100.00 | Using where |
+----+-------------+----------+------------+-------+------------------------+---------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.09 sec)


like的基本用法，和特点
1)字符串类型，有索引的列最好使用'a%'形式，可以使用到一些索引 
root@192.168.0.254 3307 [employees]>desc select * from test1 where id like '1%';
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+
| id | select_type | table | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                 |
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+
|  1 | SIMPLE      | test1 | NULL       | range | ix_id         | ix_id | 33      | NULL |    2 |   100.00 | Using index condition |
+----+-------------+-------+------------+-------+---------------+-------+---------+------+------+----------+-----------------------+
1 row in set, 1 warning (0.00 sec)

2) like 模糊查询 '%a%' 则用不了索引
root@192.168.0.254 3307 [employees]>desc select * from test1 where id like '%1%';
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | test1 | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    4 |    25.00 | Using where |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+

3)日期类型，不能进行 '20%'这种查询，则不能使用索引
root@192.168.0.254 3307 [employees]>desc salaries;
+-----------+---------+------+-----+---------+-------+
| Field     | Type    | Null | Key | Default | Extra |
+-----------+---------+------+-----+---------+-------+
| emp_no    | int(11) | NO   | PRI | NULL    |       |
| salary    | int(11) | NO   |     | NULL    |       |
| from_date | date    | NO   | PRI | NULL    |       |
| to_date   | date    | NO   |     | NULL    |       |
+-----------+---------+------+-----+---------+-------+

root@192.168.0.254 3307 [employees]>desc select * from salaries where emp_no='10001' and from_date like '1986%';   //key_lan没有包含日期索引长度
+----+-------------+----------+------------+------+----------------+---------+---------+-------+------+----------+-------------+
| id | select_type | table    | partitions | type | possible_keys  | key     | key_len | ref   | rows | filtered | Extra       |
+----+-------------+----------+------------+------+----------------+---------+---------+-------+------+----------+-------------+
|  1 | SIMPLE      | salaries | NULL       | ref  | PRIMARY,emp_no | PRIMARY | 4       | const |   17 |    11.11 | Using where |
+----+-------------+----------+------------+------+----------------+---------+---------+-------+------+----------+-------------+
1 row in set, 2 warnings (0.00 sec)

root@192.168.0.254 3307 [employees]>desc select * from salaries  where emp_no='10001' and from_date='2002-06-22';    //key_lan包含日期索引长度
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------+
| id | select_type | table    | partitions | type  | possible_keys  | key     | key_len | ref         | rows | filtered | Extra |
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------+
|  1 | SIMPLE      | salaries | NULL       | const | PRIMARY,emp_no | PRIMARY | 7       | const,const |    1 |   100.00 | NULL  |
+----+-------------+----------+------------+-------+----------------+---------+---------+-------------+------+----------+-------+

日期类型改写
root@192.168.0.254 3307 [employees]>desc select * from salaries where emp_no='10001' and from_date>='1986-01-01' and from_date>='1986-12-31';
+----+-------------+----------+------------+-------+----------------+---------+---------+------+------+----------+-------------+
| id | select_type | table    | partitions | type  | possible_keys  | key     | key_len | ref  | rows | filtered | Extra       |
+----+-------------+----------+------------+-------+----------------+---------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | salaries | NULL       | range | PRIMARY,emp_no | PRIMARY | 7       | NULL |   16 |   100.00 | Using where |
+----+-------------+----------+------------+-------+----------------+---------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)


4）数字类型有索引，使用'10%'不能使用索引，数据类型改写SQL有点麻烦，需要与其它辅助条件相结合
root@192.168.0.254 3307 [employees]>desc select * from employees where emp_no like '1000%';   //全表扫描
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+
| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+
|  1 | SIMPLE      | employees | NULL       | ALL  | PRIMARY       | NULL | NULL    | NULL | 286666 |    11.11 | Using where |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------------+


选择率,去掉重复值后，越接近count(*)的列选择率越高,如下SQL
root@192.168.0.254 3307 [employees]>select count(distinct emp_no),count(distinct from_date),count(*) from salaries;
+------------------------+---------------------------+----------+
| count(distinct emp_no) | count(distinct from_date) | count(*) |
+------------------------+---------------------------+----------+
|                 300024 |                      6392 |  2844047 |
+------------------------+---------------------------+----------+

root@192.168.0.254 3307 [employees]>select count(distinct emp_no,from_date) from salaries;
+----------------------------------+
| count(distinct emp_no,from_date) |
+----------------------------------+
|                          2844047 |
+----------------------------------+


root@192.168.0.254 3307 [employees]>show index from salaries;       //选择率也可以使用show index from tb_nam来看，主要看Cardinality
+----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| Table    | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment |
+----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| salaries |          0 | PRIMARY  |            1 | emp_no      | A         |      299949 |     NULL | NULL   |      | BTREE      |         |               |
| salaries |          0 | PRIMARY  |            2 | from_date   | A         |     2838426 |     NULL | NULL   |      | BTREE      |         |               |
| salaries |          1 | emp_no   |            1 | emp_no      | A         |      298224 |     NULL | NULL   |      | BTREE      |         |               |
+----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
3 rows in set (0.01 sec)

```